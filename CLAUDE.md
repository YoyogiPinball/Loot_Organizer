# Loot Organizer

個人用ファイル整理ツール - 2段階ワークフローによるファイル管理システム

## プロジェクト概要

Loot Organizerは、ダウンロードフォルダなどに散らばったファイルを効率的に整理するためのCLIツールです。
ユーザーが設定したルール（YAML形式）に基づいて、ファイルの振り分け、クリーンアップ、削除を自動化します。

### 設計思想

- **設定駆動型**: YAML設定ファイルで処理ルールを定義
- **インタラクティブUI**: ↑↓キーで選択するモダンなCLI
- **非破壊的確認**: 実行前に必ずプレビューを表示し、ユーザー確認を取る
- **多言語対応**: 日本語/英語（将来実装予定）
- **プリセット管理**: よく使う設定をプリセットとして保存・選択可能

## ワークフロー

```
ダウンロードフォルダ（カオス）
    ↓
【Sort モード】大まかに振り分け
    ↓
動画フォルダ、スクショフォルダ etc...
    ↓
【外部ツール: Zippla】ラベリング（r=5, t=V など）
    ↓
【Clean モード】クリーンアップ＋低レート削除
    ↓
完成！
```

## プロジェクト構造

```
Loot_Organizer/
├── src/
│   └── loot_manager.py          # メインスクリプト
├── configs/
│   ├── samples/                 # サンプル設定集（Git管理対象）
│   │   ├── downloads_sort.yaml  # ダウンロード振り分けサンプル
│   │   ├── cleanup_files.yaml   # クリーンアップサンプル
│   │   └── custom_example.yaml  # カスタム例
│   └── *.yaml                   # ユーザーの個人設定（Git除外）
├── MigrationSource/             # 統合前の旧スクリプト（参考用）
│   ├── File_Flow/
│   └── File_organizer/
├── requirements.txt
├── run.bat                      # 起動用バッチファイル
├── .gitignore
├── CLAUDE.md                    # このファイル
└── logs/                        # 実行ログ（Git除外）
```

## コアモード

### Sort モード
**目的**: ゴチャついたフォルダから各種フォルダへファイルを振り分け

**処理内容**:
- パターンマッチングによるファイル移動
- 除外設定（特定ファイルをスキップ）
- プレビュー → 確認 → 実行

**ベース**: 旧`File_organizer`スクリプト

**典型的な用途**:
- ダウンロードフォルダ → 動画/画像/ドキュメントフォルダ
- 拡張子ベースの振り分け
- ファイル名パターンベースの振り分け

### Clean モード
**目的**: 既に振り分けられたファイルのクリーンアップと整理

**処理内容**:
1. **削除処理**: 特定文字列を含むファイルを削除（例: `{zpi$r=1}`）
2. **クリーンアップ**: 絵文字・特殊文字の除去（Android互換性向上）
3. **振り分け**: ラベル付きファイルの分類（copy/move/delete）

**ベース**: 旧`File_Flow`スクリプト

**典型的な用途**:
- Zipplaでラベリング後の処理
- 低レートファイル（r=1）の一括削除
- タグ付きファイル（t=V, t=pic等）の振り分け
- ファイル名から絵文字除去

### 連続実行モード
**目的**: 複数のプリセットを順番に実行

**処理内容**:
- チェックボックス形式で実行するプリセットを選択
- 選択順に自動実行
- 各ステップでプレビュー・確認

**典型的な用途**:
- ダウンロード振り分け → クリーンアップの一連の流れを自動化

## 設定ファイル構造

### 共通メタ情報
全てのYAML設定ファイルには以下のメタ情報が必要です：

```yaml
meta:
  name: "設定名（メニューに表示）"
  icon: "📤"  # 絵文字アイコン
  mode: "Sort"  # SortまたはClean
  description: "この設定の説明"
```

### Sort モード設定例

```yaml
meta:
  name: "ダウンロード振り分け"
  icon: "📤"
  mode: "Sort"
  description: "ダウンロードフォルダから各種フォルダへ振り分け"

settings:
  target_directory: "C:\\Users\\username\\Downloads"
  enable_logging: true
  confirm_before_execute: true
  log_directory: "logs"

# 移動ルール（上から順に優先、最初にマッチしたルールを適用）
move_rules:
  - pattern: "*.mp4"
    dest: "D:\\Videos"
    description: "動画ファイル"
    enabled: true

  - pattern: "*screenshot*"
    dest: "C:\\Pictures\\Screenshots"
    description: "スクリーンショット"
    enabled: true

# 除外パターン（移動しないファイル）
exclusions:
  exact_names:
    - "desktop.ini"
    - "Thumbs.db"
  patterns:
    - "*.tmp"
    - "*.bak"
```

### Clean モード設定例

```yaml
meta:
  name: "ファイルクリーンアップ"
  icon: "✨"
  mode: "Clean"
  description: "絵文字除去・低レート削除・振り分け"

settings:
  target_directory: "D:\\SortedFiles"
  enable_logging: true
  confirm_before_execute: true
  log_directory: "logs"

# ステップ1: 削除処理
deletion:
  enabled: true
  strings:
    - "{zpi$r=1}"  # 低レートファイル
  recursive: true

# ステップ2: クリーンアップ
cleanup:
  enabled: true
  recursive: true
  custom_patterns: []  # 追加の正規表現パターン

# ステップ3: 振り分けルール
sorting_rules:
  - search: "*r=5*"
    destination: "D:\\HighRated"
    action: "copy"  # copy/move/delete

  - search: "*t=V*"
    destination: "D:\\Videos\\Tagged"
    action: "move"
```

## UI/UX設計

### メインメニュー

```
╔════════════════════════════════════════════╗
║  📁 Loot Organizer                        ║
╠════════════════════════════════════════════╣
║                                            ║
║  ▶ 📤 ダウンロード振り分け [Sort]         ║
║    ✨ ファイルクリーンアップ [Clean]      ║
║    🔄 連続実行モード                      ║
║    ❌ 終了                                ║
║                                            ║
╠════════════════════════════════════════════╣
║  ↑↓: 選択 | Enter: 決定                   ║
╚════════════════════════════════════════════╝
```

### プレビュー表示（Sort モード例）

```
╔════════════════════════════════════════════╗
║  📋 移動対象プレビュー                    ║
╠════════════════════════════════════════════╣
║                                            ║
║  📁 D:\Videos (15件)                      ║
║    ├─ video001.mp4                        ║
║    ├─ video002.mp4                        ║
║    └─ ... 他13件                          ║
║                                            ║
║  📁 C:\Pictures\Screenshots (8件)         ║
║    ├─ screenshot_01.png                   ║
║    └─ ... 他7件                           ║
║                                            ║
║  合計: 23件                               ║
╠════════════════════════════════════════════╣
║  この内容で実行しますか? (y/N):          ║
╚════════════════════════════════════════════╝
```

### カラー出力規則

- **Cyan**: ヘッダー、タイトル
- **Green**: 成功メッセージ、処理完了
- **Yellow**: 警告、プレビュー、確認プロンプト
- **Red**: エラーメッセージ
- **White背景+Black文字**: 選択中の項目（ハイライト）

## 技術スタック

- **言語**: Python 3.7+
- **主要ライブラリ**:
  - `questionary`: インタラクティブCLI（↑↓選択）
  - `colorama`: クロスプラットフォームカラー出力
  - `pyyaml`: YAML設定ファイル読み込み
  - `pathlib`: パス操作

## 開発ガイドライン

### コーディング規約

1. **コメントは多めに**: 1年後に見ても理解できるように
2. **日本語コメント推奨**: 個人プロジェクトのため
3. **関数のdocstring**: 必ず記載（目的、引数、戻り値）
4. **エラーハンドリング**: 想定される例外は全てキャッチ
5. **ログ出力**: 重要な処理は必ずログに記録

### 非破壊的操作の原則

**重要**: ファイル操作は必ず以下のフローを守ること：

```
1. 処理対象をスキャン
2. プレビュー表示
3. ユーザー確認
4. 実行
5. 結果サマリー表示
```

### プリセット自動検出

`configs/`フォルダ内のYAMLファイルは起動時に自動検出され、メニューに表示されます。

**検出ルール**:
- `configs/samples/`内のファイルはサンプル（メニューには表示しない）
- `configs/`直下の`*.yaml`ファイルを実行可能プリセットとして認識
- `meta`セクションが無いYAMLは無視

### ログ管理

- **ファイル名**: `logs/YYYY-MM-DD.log`（日付ごとに1ファイル）
- **フォーマット**: `YYYY-MM-DD HH:MM:SS [レベル] メッセージ`
- **追記モード**: 同日の複数実行を1ファイルに記録

## よくある使い方

### ケース1: ダウンロードフォルダの整理

1. `configs/downloads_sort.yaml`を自分の環境に合わせて編集
2. `run.bat`をダブルクリック
3. 「📤 ダウンロード振り分け」を選択
4. プレビュー確認 → 実行

### ケース2: Zippla後のクリーンアップ

1. Zipplaでファイルにラベル付け（r=5, t=V など）
2. `run.bat`をダブルクリック
3. 「✨ ファイルクリーンアップ」を選択
4. プレビュー確認 → 実行

### ケース3: フル自動化ワークフロー

1. `run.bat`をダブルクリック
2. 「🔄 連続実行モード」を選択
3. 実行したいプリセットをチェック（Space）
4. Enter → 順番に自動実行

## トラブルシューティング

### プリセットがメニューに表示されない

- `meta`セクションが正しく記載されているか確認
- YAMLの文法エラーがないか確認（インデント等）
- ファイルが`configs/`直下にあるか確認（`configs/samples/`内は除外）

### ファイルが移動/削除されない

- ドライランモードになっていないか確認
- 確認プロンプトで`y`を入力したか確認
- ログファイルでエラーを確認

### 絵文字が文字化けする

- Windowsの場合: コマンドプロンプトではなくWindows Terminalを使用
- フォントを絵文字対応フォント（Cascadia Code等）に変更

## 今後の拡張予定

- [ ] 多言語対応（日本語/英語）
- [ ] 処理統計のグラフ表示
- [ ] 設定ファイルのGUIエディタ
- [ ] スケジュール実行機能

## ライセンス

個人利用・商用利用ともに自由に使用可能です。

---

**作成者**: ikoooou
**最終更新**: 2025-11-16
